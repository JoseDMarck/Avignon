
map.on('load', function () {

 
var geojson = {
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 3h en avion",
                "message": "Lisboa",
                "description": "<strong>**Make it Mount Pleasant</strong><p><a href=\"http://www.mtpleasantdc.com/makeitmtpleasant\" target=\"_blank\" title=\"Opens in a new window\">Make it Mount Pleasant</a> is a handmade and vintage market and afternoon of live entertainment and kids activities. 12:00-6:00 p.m.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    -9.160,
                    38.744
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 2h30 en avion",
                "message": "Madrid",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                   -3.704,
                   40.478,
                ]
            }
        },
        
          
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 2h en avion",
                "message": "London",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                   -0.087,
                   51.489,
                ]
            }
        },
         {
            "type": "Feature",
            "properties": {
                "Name": "<span class='tren_a'></span> 2h40 en TGV",
                "message": "Paris",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                   2.347,
                   48.859,
                ]
            }
        },
        
         {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 1h45 en avion",
                "message": "Brussels",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                   4.369,
                   50.843 
                ]
            }
        },

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 2h en avion",
                "message": "Berlin",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                   13.424,
                   52.507 
                ]
            }
        }, 

          

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 1h15 en avion",
                "message": "Milan",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                  9.129,45.402
                ]
            }
        }, 

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 1h en avion",
                "message": "Rome",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                 12.470,41.802
                ]
            }
        }, 

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 2h30 en avion",
                "message": "Athenas",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                 23.734,37.987
                ]
            }
        }, 


        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 2h30 en voiture",
                "message": "Nice",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                 7.253,43.703
                ]
            }
        }, 



        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span>1h en voiture",
                "message": "Lyon",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-green.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    4.838889282190763,45.75233098194187
                ]
            }
        },
       

         
       

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 1h en voiture",
                "message": "Marselle",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-green.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    5.369930168458609,43.29620715909331
                ]
            }
        },


        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='tren_a'></span> 4h en TGV",
                "message": "Barcelona",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-orange.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    2.175281788170082,41.382431374681744
                ]
            }
        },

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 4h30",
                "message": "Genova",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-orange.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    8.933959300786313,44.40696948694833
                ]
            }
        },

  {
            "type": "Feature",
            "properties": {
                "Name": "Avignon",
                "message": "Avignon",
                "iconSize": [25, 25],
                "nameIcon": "pin.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    4.806820743234113,43.94474033203062
                ]
            }
        },

        

        
    ],

};




 



geojson.features.forEach(function(marker) {

    // create a DOM element for the marker
    var el = document.createElement('div');

    el.className = 'marker';
    el.style.backgroundImage = 'url(./images/pines/' + marker.properties.nameIcon + ')';
    el.style.backgroundSize = "100% 100%";
    el.style.width = marker.properties.iconSize[0] + 'px';
    el.style.height = marker.properties.iconSize[1] + 'px';




     // add marker to map
    new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);


        // Create a popup, but don't add it to the map yet.
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });


    

   el.addEventListener('mouseover', function() {
        popup.setLngLat(marker.geometry.coordinates)
        .setHTML(marker.properties.Name)
        .addTo(map);
    });



     el.addEventListener('mouseout', function() {  
       popup.remove();
       return;
    }); 



    
    el.addEventListener('click', function() {
        //window.alert(marker.properties.message);



        $("#info").mCustomScrollbar("destroy");
   
            // Comprobamos que este oculto el siderBar para mostrarlo 
            if ( $(".siderbar_1").css('display') == 'none' ){
                 $( ".siderbar_1" ).toggle( "slide", {direction: 'right'}, function(){ });
                 $( ".open_info_btn" ).hide();
             }

     

        // Cacheing HTML elements
        var project = document.querySelector('#info');
        project.style.opacity = 0;

        
        setTimeout(function(){ 
           // Agregamos las propiedades de descripción con innerHTML
            project.style.opacity = 1;


            $.ajax({url: "", 
            success: function(result){
                 
                console.log("Succes!!!")
                $("#info").mCustomScrollbar({theme:"minimal",
                    advanced:{
                        updateOnContentResize: true
                    }
                });

                $("#info").mCustomScrollbar("update");


            
            }});
             
        },400);



    });

   

    // add marker to map
    new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);
});




});



 



 



 