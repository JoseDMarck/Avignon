
map.on('load', function () {

 
var geojson = {
    "type": "FeatureCollection",
    "features": [
         
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 5 heures",
                "message": "Turin",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                  7.696095890595387,45.06275459536073
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 2h30",
                "message": "Nice",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                 7.4055716782055185,43.74192919988511
                ]
            }
        },
         {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 1 heure en avion",
                "message": "Ajaccio",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                   8.735025556629893,41.923424039272476
                ]
            }
        },
        
         {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 1h30 en avion",
                "message": "Tunis",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                  9.581989850921758,34.096548664664766
                ]
            }
        },
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 1h40 en avion",
                "message": "Alger",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                  3.0629155477888617,36.738611592493
                ]
            }
        },
          
        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='avion_a'></span> 2h30 en avion",
                "message": "Rabat",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                  -6.833833340199732,34.02229443496822
                ]
            }
        }, 

         {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 2h30",
                "message": "Perpignan",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                  2.882181278449991,42.69891346298559
                ]
            }
        }, 

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 1 heure",
                "message": "Montpellier",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                 3.876689130103614,43.61014966221117
                ]
            }
        }, 

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 3 heures",
                "message": "Toulouse",
                "description": "<strong>Capital Pride Parade</strong><p>The annual <a href=\"http://www.capitalpride.org/parade\" target=\"_blank\" title=\"Opens in a new window\">Capital Pride Parade</a> makes its way through Dupont this Saturday. 4:30 p.m. Free.</p>",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-off.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                 1.4415228172669288,43.6006657474729
                ]
            }
        }, 

        

         {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span>2 heures",
                "message": "Lyon",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-green.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    4.838889282190763,45.75233098194187
                ]
            }
        },
       

         
       

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 1 heure",
                "message": "Marselle",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-green.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    5.369930168458609,43.29620715909331
                ]
            }
        },


        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 4h30",
                "message": "Barcelona",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-orange.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    2.175281788170082,41.382431374681744
                ]
            }
        },

        {
            "type": "Feature",
            "properties": {
                "Name": "<span class='auto_a'></span> 4h30",
                "message": "Genova",
                "iconSize": [10, 10],
                "nameIcon": "botones_avignon-orange.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    8.933959300786313,44.40696948694833
                ]
            }
        },

  {
            "type": "Feature",
            "properties": {
                "Name": "Avignon",
                "message": "Avignon",
                "iconSize": [25, 25],
                "nameIcon": "pin.png"
            },
            "geometry": {
                "type": "Point",
                "coordinates": [
                    4.806820743234113,43.94474033203062
                ]
            }
        },

        

        
    ],

};




 



geojson.features.forEach(function(marker) {

    // create a DOM element for the marker
    var el = document.createElement('div');

    el.className = 'marker';
    el.style.backgroundImage = 'url(./images/pines/' + marker.properties.nameIcon + ')';
    el.style.backgroundSize = "100% 100%";
    el.style.width = marker.properties.iconSize[0] + 'px';
    el.style.height = marker.properties.iconSize[1] + 'px';




     // add marker to map
    new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);


        // Create a popup, but don't add it to the map yet.
        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: false
        });


    

   el.addEventListener('mouseover', function() {
        popup.setLngLat(marker.geometry.coordinates)
        .setHTML(marker.properties.Name)
        .addTo(map);
    });



     el.addEventListener('mouseout', function() {  
       popup.remove();
       return;
    }); 





    
    el.addEventListener('click', function() {
        //window.alert(marker.properties.message);

        $("#info").mCustomScrollbar("destroy");
   
            // Comprobamos que este oculto el siderBar para mostrarlo 
            if ( $(".siderbar_1").css('display') == 'none' ){
                 $( ".siderbar_1" ).toggle( "slide", {direction: 'right'}, function(){ });
                 $( ".open_info_btn" ).hide();
             }


        // Cacheing HTML elements
        var project = document.querySelector('#info');
        project.style.opacity = 0;

        
        setTimeout(function(){ 
           // Agregamos las propiedades de descripción con innerHTML
            project.style.opacity = 1;


            $.ajax({url: "", 
            success: function(result){
                 
                console.log("Succes!!!")
                $("#info").mCustomScrollbar({theme:"minimal",
                    advanced:{
                        updateOnContentResize: true
                    }
                });

                $("#info").mCustomScrollbar("update");


            
            }});
             
        },400);



    });

   

    // add marker to map
    new mapboxgl.Marker(el, {offset: [-marker.properties.iconSize[0] / 2, -marker.properties.iconSize[1] / 2]})
        .setLngLat(marker.geometry.coordinates)
        .addTo(map);
});




});



 



 



 